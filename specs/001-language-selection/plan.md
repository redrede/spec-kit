# Implementation Plan: Multi-Language Support for Specifications

**Branch**: `001-language-selection` | **Date**: 2026-01-18 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-language-selection/spec.md`

---

## Summary

Add multi-language support to Spec Kit, enabling users to select their preferred language (English or Brazilian Portuguese) during project initialization. All templates, constitution, and AI-generated content will be provided in the selected language. The implementation uses existing libraries and patterns, adding no new dependencies.

---

## Technical Context

**Language/Version**: Python 3.11+
**Primary Dependencies**: typer, rich, httpx, readchar (all existing, no additions)
**Storage**: JSON files (`.specify/config.json` for project configuration)
**Testing**: pytest (existing)
**Target Platform**: Linux, macOS, Windows (cross-platform CLI)
**Project Type**: Single project (CLI tool)
**Performance Goals**: Language selection adds <100ms to project initialization
**Constraints**: No new dependencies; maintain backward compatibility
**Scale/Scope**: 2 languages at launch (en, pt-BR); extensible to more

---

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### I. Specification-First Development ✅

- [x] Feature specification created (`spec.md`)
- [x] Clear requirements defined before implementation
- [x] No code written before planning

### II. Intent-Driven Development ✅

- [x] Spec focuses on WHAT (language selection) and WHY (native language accessibility)
- [x] Technical details deferred to this plan
- [x] User stories are independently testable

### III. Research-Driven Context ✅

- [x] Codebase exploration completed
- [x] Technical decisions documented in `research.md`
- [x] No assumptions made without research

### IV. Test-First Discipline ✅

- [x] Acceptance scenarios defined in spec
- [x] Validation scenarios documented in `quickstart.md`
- [ ] Tests will be written before implementation (during `/speckit.tasks`)

### V. Simplicity and Minimalism ✅

- [x] No new dependencies
- [x] Single project structure maintained
- [x] Using existing patterns (`select_with_arrows()`, JSON config)
- [x] No speculative features
- [x] YAGNI followed: only en and pt-BR for now

---

## Project Structure

### Documentation (this feature)

```text
specs/001-language-selection/
├── plan.md              # This file
├── research.md          # Technical research and decisions
├── data-model.md        # Configuration and template structures
├── quickstart.md        # Validation scenarios
├── contracts/
│   └── cli-interface.md # CLI contract specification
├── checklists/
│   └── requirements.md  # Spec quality checklist
└── tasks.md             # [Generated by /speckit.tasks]
```

### Source Code (repository root)

```text
src/specify_cli/
└── __init__.py          # Main CLI code (single file, ~1400 lines)
                         # Modifications:
                         #   - Add LANGUAGE_CHOICES constant
                         #   - Add --language flag to init()
                         #   - Add language selection prompt
                         #   - Add config file writing
                         #   - Add template path resolution

templates/               # Source templates (in release ZIP)
├── en/                  # English templates
│   ├── spec-template.md
│   ├── plan-template.md
│   ├── tasks-template.md
│   ├── checklist-template.md
│   └── agent-file-template.md
├── pt-BR/               # Brazilian Portuguese templates
│   ├── spec-template.md
│   ├── plan-template.md
│   ├── tasks-template.md
│   ├── checklist-template.md
│   └── agent-file-template.md
├── commands/
│   ├── en/              # English command prompts
│   │   ├── specify.md
│   │   ├── plan.md
│   │   ├── tasks.md
│   │   └── ...
│   └── pt-BR/           # Portuguese command prompts
│       ├── specify.md
│       ├── plan.md
│       ├── tasks.md
│       └── ...
└── constitution/
    ├── en/
    │   └── constitution.md
    └── pt-BR/
        └── constitution.md

tests/                   # Test files
├── unit/
│   └── test_language.py # Language selection unit tests
└── integration/
    └── test_init_language.py # End-to-end language tests
```

**Structure Decision**: Extending existing single-project structure. Templates reorganized into language subdirectories. CLI remains a single-file module.

---

## Implementation Phases

### Phase 1: CLI Language Selection (P1 - Core)

**Goal**: Enable language selection during `specify init`

**Changes to `src/specify_cli/__init__.py`**:

1. **Add LANGUAGE_CHOICES constant** (~line 230):
   ```python
   LANGUAGE_CHOICES = {
       "en": "English (Default)",
       "pt-BR": "Português (Brasil)",
   }
   ```

2. **Add --language option to init()** (~line 955):
   ```python
   language: str = typer.Option(None, "--language", "-l",
       help="Language for templates and AI content (en, pt-BR)")
   ```

3. **Add language selection prompt** (~line 1060, after AI selection):
   - Use existing `select_with_arrows()` function
   - Default to "en"
   - Skip if `--language` flag provided

4. **Write config file after extraction** (~line 1130):
   ```python
   config = {"language": selected_language, "version": "1.0"}
   config_path = project_path / ".specify" / "config.json"
   config_path.write_text(json.dumps(config, indent=2))
   ```

5. **Update success message** to include language

### Phase 2: Template Reorganization (P2 - Templates)

**Goal**: Organize templates into language-specific directories

**Changes to `templates/` directory**:

1. Create `templates/en/` directory
2. Move existing templates to `templates/en/`:
   - `spec-template.md`
   - `plan-template.md`
   - `tasks-template.md`
   - `checklist-template.md`
   - `agent-file-template.md`

3. Create `templates/pt-BR/` directory
4. Create Portuguese translations of all templates

**Changes to template ZIP build process**:
- Include language directories in ZIP structure
- Copy language-specific templates to `.specify/templates/{lang}/`

### Phase 3: Command Prompts Localization (P3 - AI Instructions)

**Goal**: AI generates content in selected language

**Changes to `templates/commands/` directory**:

1. Create `templates/commands/en/` directory
2. Move existing command files to `en/`
3. Create `templates/commands/pt-BR/` directory
4. Translate command files with language directive:
   ```markdown
   ## Diretiva de Idioma
   Gere todo o conteúdo em Português do Brasil.
   ```

### Phase 4: Constitution Localization (P4 - Constitution)

**Goal**: Provide constitution in selected language

**Changes**:

1. Create `templates/constitution/en/constitution.md`
2. Create `templates/constitution/pt-BR/constitution.md`
3. During `specify init`, copy appropriate constitution to `.specify/memory/`

### Phase 5: Fallback and Validation (P5 - Robustness)

**Goal**: Handle missing translations and errors gracefully

**Add utility functions**:

1. `get_project_language(project_path: Path) -> str`:
   - Read from `.specify/config.json`
   - Return "en" if file missing or invalid

2. `get_template_path(template_name: str, language: str) -> Path`:
   - Try language-specific path first
   - Fallback to English with warning
   - Raise error if neither exists

3. `validate_language_code(code: str) -> bool`:
   - Check against LANGUAGE_CHOICES keys
   - Return helpful error for invalid codes

---

## Complexity Tracking

> **No violations** - all constitution gates pass.

| Check | Status | Notes |
|-------|--------|-------|
| Single project? | ✅ | Single CLI module |
| ≤3 projects? | ✅ | Only 1 project |
| No future-proofing? | ✅ | Only en + pt-BR, no speculation |
| Using framework directly? | ✅ | typer, rich used directly |
| No custom abstractions? | ✅ | Reusing select_with_arrows() |

---

## Dependencies

### Existing (No Changes)

- `typer` - CLI framework
- `rich` - Terminal UI
- `httpx` - HTTP client
- `readchar` - Keyboard input
- `json` - Configuration (built-in)

### New Dependencies

**None required.**

---

## Risks and Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Translation quality issues | Medium | Medium | Native speaker review before release |
| Missing translation files | Low | Low | Fallback mechanism with warning |
| Breaking existing projects | Low | High | Backward compatible: missing config defaults to English |
| Release asset naming conflicts | Low | Medium | Clear naming convention: `{ai}-{script}-{lang}.zip` |

---

## Success Metrics

From spec, to be validated post-implementation:

- **SC-001**: Setup with language selection < 30 seconds ✓
- **SC-002**: 100% Portuguese template coverage ✓
- **SC-003**: Full Portuguese workflow without English text ✓
- **SC-004**: New language addable in < 4 hours (excluding translation) ✓
- **SC-005**: Transparent fallback behavior ✓
- **SC-006**: User satisfaction parity ✓

---

## Related Documents

- [spec.md](./spec.md) - Feature specification
- [research.md](./research.md) - Technical research
- [data-model.md](./data-model.md) - Data structures
- [quickstart.md](./quickstart.md) - Validation scenarios
- [contracts/cli-interface.md](./contracts/cli-interface.md) - CLI contract
